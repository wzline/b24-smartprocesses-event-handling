# Кастомный обработчик событий для смарт-процессов в CRM Битрикс24

Пример структуры файлов для реализации своих обработчиков событий в смарт-процессах Битрикс24.

[В документации](https://dev.1c-bitrix.ru/api_d7/bitrix/crm/customization/index.php) расплывчато описан механизм реализации обработки событий добавления, обновления и удаления для смарт-процессов, что заставило меня потратить несколько часов, чтобы с этим разобраться.

В результате чтения документации и эксперементов родилась следущая структура.

1. В файле `/local/php_interface/init.php` размещаем скрипт, который будет регистрировать наш кастомный контейнер
1. В файле `/local/modules/zd.tools/lib/service/container.php` реализация контейнера
    1. Метод `getFactory` возвращает кастомные фабрики для работы с нашими смарт-процессами
    1. Я реализовал логику таким образом, что проверяется наличие класса (фабрики) по идентификатору смарт-процесса.
    Если такой класс (фабрика) существует, то она будет возвращена.
1. В классе кастомной фабрики `/local/modules/zd.tools/lib/service/factory/dynamic_174.php` переопределен метод `getUpdateOperation`, в котором добавляются операции для обработки наших событий.
  
